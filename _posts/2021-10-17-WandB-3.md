---
layout: post
title: "3. WandB의 다양한 시각화방법 (feat. Confusion Matrices)"
subtitle : WandB-3
tags: [WandB]
categories: WandB
author: Kimin Park
comments : True
typora-root-url: ../
---

> WandB를 이용해서 ROC, PR curves와 Confusion Matrices등 다양한 시각화 방법을 알아 보겠습니다. 

 [![image-20211017235128747](/assets/github.svg)](https://github.com/PEBpung/WandB-Tutorial/blob/master/3.metric/wandb_log_roc_pr_cm.ipynb)   [![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/PEBpung/WandB-Tutorial/blob/master/3.metric/wandb_log_roc_pr_cm.ipynb)

## 개요 

안녕하세요!! 이번 글에서는 WandB에서 모델 예측을 시각화하고 대시보드에 표시 할 수 있는 방법에 대해서 알아볼 예정이예요. 

우리는 앞서 [WandB이란?](https://pebpung.github.io/wandb/2021/10/06/WandB-1.html)의 글에서 머신러닝의 학습을 도와주는 tool에 대해서 다뤄봤어요. 이 중에서 모델 학습을 시각화 하기 위해서 대시보드라는 기능을 다뤄봤네요. 오늘은 학습을 시각화 하는 방식을 좀 더 깊게 알아볼 예정입니다.



## 다양한 시각화 방법

---



<figure>
    <center><img src="/assets/image-20211018002140616.png" alt="image-20211018002140616" style="zoom:67%;" /></center>
    <center><figcaption>출처: wandb.ai </figcaption></center>
</figure>


대표적으로 wandb에서는 학습 log 시각화를 주로 사용해요. 이번 포스터에는 wandb에서 사용할 수 있는 대시보드 종류들에 대해서 알아볼 예정입니다. 더 많은 시각화 방법이 있지만, 저희는 다음 몇개만 알아볼게요.

- loss, accuracy 그래프
- model parameter & gradients 그래프
- predict된 이미지 시각화
- sweep 그래프
- confusion matrix(혼동 행렬)
- precision(정밀도), recall (재현도) 그래프
- ROC curve (Receiver Operating Characteristic curve)



### loss, accuracy 그래프

- 코드

  ```python
  wandb.log({"train_loss": avg_loss}, step=epoch)  
  wandb.log({
          "val_acc": 100. * correct / len(loader.dataset),
          "val_loss": val_loss})
  ```

  

- 시각화

  ![image-20211103140931686](/assets/image-20211103140931686.png)

### model parameter & gradients 그래프

- 코드

```python
wandb.watch(model, criterion, log="all", log_freq=10)
```

- 시각화

  ![image-20211103140307694](/assets/image-20211103140307694.png)

### sweep 그래프

- 코드

```python
sweep_id = wandb.sweep(sweep_config, project="project_name", entity='wandb_id')
wandb.agent(sweep_id, run_sweeep, count=6)
```

- 시각화

  ![image-20211103140337772](/assets/image-20211103140337772.png)



## 분류 성능 평가지표 시각화 

---

confusion matrix, precision, recall, ROC curve는 주로 분류 문제에서 주로 사용되는 metric입니다. 의료 영상을 분류할 때도 자주 사용되는 평가 지표입니다. 다음 3가지 방법에 대한 시각화 코드도 알고 있다면 유용하게 사용될 것입니다. 

### ROC curve

- 코드

```python
wandb.log({'roc': wandb.plots.ROC(y_test, y_prob_pred, cnb.classes_)})

```

- 시각화

  ![image-20211103141205752](/assets/image-20211103141205752.png)

### Confusion matrix

- 코드

```python
wandb.sklearn.plot_confusion_matrix(y_test, y_pred, labels=classes_name)
```

- 시각화

  <img src="/assets/image-20211019090855433.png" alt="image-20211019090855433" style="zoom:67%;" />

- 코드

```python
wandb.log({"Confusion Matrix" : wandb.plot.confusion_matrix(preds=best_all_preds, y_true=best_all_labels, class_names=classes_name)})
```

- 시각화

  ![image-20211103141849146](/assets/image-20211103141849146.png)

### Precision-Recall 

- 코드

```python
wandb.log({'pr': wandb.plots.precision_recall(y_test, y_prob_pred, cnb.classes_)})
```

- 시각화

  <img src="/assets/image-20211019090938815.png" alt="image-20211019090938815" style="zoom: 33%;" />













